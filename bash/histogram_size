#!/bin/bash

function print_histogram() {
    # visualization for easier debugging, unused
    for n in "$@"
    do
        printf "%${n}s\n" '' | tr ' ' 'X'
    done
}

function unique_values_desc() {
    # Unique values sorted in descending order
    printf '%s\n' "$@" | sort -rg | uniq
}

function clamp_values_to() {
    # Clamp each numeric value to the given max
    local max_value=$1
    local value
    while IFS= read -r value; do
        printf '%s\n' "$((value < max_value ? value : max_value))"
    done
}

function largest_full_rect() {
    uniq -c | awk '{ print $1 * $2 }' | sort -rg | head -n 1
}

function largest_rect_in_histogram() {
    local maximum_size=0
    for n in $(unique_values_desc "$@"); do
        local largest_at_this_level
        largest_at_this_level=$(printf '%s\n' "$@" | \
            clamp_values_to "${n}" | \
            largest_full_rect)
        if [ "${largest_at_this_level}" -gt "${maximum_size}" ]; then
            maximum_size=${largest_at_this_level}
        fi
    done
    printf '%s\n' "${maximum_size}"
}
